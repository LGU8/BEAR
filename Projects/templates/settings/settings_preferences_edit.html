{% extends "settings/settings_base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/settings/settings_base.css' %}">
<link rel="stylesheet" href="{% static 'css/settings/settings_s3.css' %}">
{% endblock %}

{% block extra_js %}
<script defer src="{% static 'js/settings/settings_s3.js' %}"></script>
{% endblock %}

{% block main_area %}
<section class="settings-page s3">
  <article class="settings-card edit-card">

    <!-- 헤더 -->
    <div class="edit-header">
      <a class="back-btn" href="{% url 'settings_app:settings_account' %}" aria-label="back">
        <img src="{% static 'settings_img/icon_back.png' %}" alt="back">
      </a>
      <div class="edit-title">선호도 수정</div>
      <div class="edit-header-spacer"></div>
    </div>

    {% if error %}
      <div class="error">{{ error }}</div>
    {% endif %}

    <!-- POST -->
    <form id="prefForm" method="post" action="{% url 'settings_app:preferences_edit' %}">
      {% csrf_token %}

      <!-- ✅ 서버 저장값(ratio 합=10) -->
      <input type="hidden" name="ratio_carb" id="ratioCarb" value="{{ ratio_carb|default:0 }}">
      <input type="hidden" name="ratio_protein" id="ratioProtein" value="{{ ratio_protein|default:0 }}">
      <input type="hidden" name="ratio_fat" id="ratioFat" value="{{ ratio_fat|default:0 }}">

      <!-- ✅ UI 선택값(-1/0/1) : 서버로는 보내지 않음(프론트 계산용) -->
      <input type="hidden" id="choiceCarb" value="0">
      <input type="hidden" id="choiceProtein" value="0">
      <input type="hidden" id="choiceFat" value="0">

      <!-- 안내 -->
      <div class="helper" id="helperText">
        적용 비율(합10): 탄 {{ ratio_carb|default:0 }} · 단 {{ ratio_protein|default:0 }} · 지 {{ ratio_fat|default:0 }}
      </div>

      <!-- 1) Carb -->
      <div class="q-row" data-key="carb">
        <img src="{% static 'settings_img/icon_rice.png' %}" class="q-ico" alt="carb">
        <div class="q-body">
          <div class="q-title">밥·빵·면 같은 탄수화물 음식을 어느 정도로 즐기나요?</div>
          <div class="tri" role="group" aria-label="carb preference">
            <button type="button" class="tri-btn" data-v="-1" aria-pressed="false">별로</button>
            <button type="button" class="tri-btn" data-v="0" aria-pressed="false">보통</button>
            <button type="button" class="tri-btn" data-v="1" aria-pressed="false">많이</button>
          </div>
        </div>
      </div>

      <!-- 2) Protein -->
      <div class="q-row" data-key="protein">
        <img src="{% static 'settings_img/icon_shrimp.png' %}" class="q-ico" alt="protein">
        <div class="q-body">
          <div class="q-title">고기·생선·달걀 같은 단백질 음식을 식사에서 얼마나 중요하게 생각하나요?</div>
          <div class="tri" role="group" aria-label="protein preference">
            <button type="button" class="tri-btn" data-v="-1" aria-pressed="false">별로</button>
            <button type="button" class="tri-btn" data-v="0" aria-pressed="false">보통</button>
            <button type="button" class="tri-btn" data-v="1" aria-pressed="false">많이</button>
          </div>
        </div>
      </div>

      <!-- 3) Fat -->
      <div class="q-row" data-key="fat">
        <img src="{% static 'settings_img/icon_beef.png' %}" class="q-ico" alt="fat">
        <div class="q-body">
          <div class="q-title">버터·치즈와 같은 지방 음식을 얼마나 좋아하나요?</div>
          <div class="tri" role="group" aria-label="fat preference">
            <button type="button" class="tri-btn" data-v="-1" aria-pressed="false">별로</button>
            <button type="button" class="tri-btn" data-v="0" aria-pressed="false">보통</button>
            <button type="button" class="tri-btn" data-v="1" aria-pressed="false">많이</button>
          </div>
        </div>
      </div>

      <!-- 합계 안내(선택) -->
      <div class="sum-hint" aria-live="polite">
        합계 <span id="sumNow">{{ ratio_sum|default:0 }}</span>/10
      </div>

      <!-- 저장 -->
      <div class="edit-footer">
        <button id="saveBtn" class="save-btn" type="submit" disabled>저장</button>
      </div>
    </form>

  </article>
</section>
{% endblock %}
