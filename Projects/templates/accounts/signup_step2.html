<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>회원가입 - Step 2</title>
  {% load static %}
  <style>
    body {
      background-color: #FFFBE6;
      margin: 0; padding: 0;
      font-family: 'Noto Sans KR', sans-serif;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh;
      min-height: 100dvh;
    }

    .header-container { width: 100%; max-width: 400px; padding: 40px 20px 20px; text-align: center; }
    .bear-logo { width: 120px; height: auto; margin-bottom: 20px; }
    .progress-container { width: 80%; height: 12px; background-color: #F0EAD6; border-radius: 10px; margin: 0 auto; overflow: hidden; }
    .progress-bar { width: 50%; height: 100%; background-color: #F38218; border-radius: 10px; }

    .card {
      background-color: white; width: 90%; max-width: 400px;
      border-radius: 15px; padding: 30px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      margin-top: 10px; box-sizing: border-box; margin-bottom: 40px;
    }
    h2 { font-size: 1.4rem; font-weight: 800; margin-bottom: 10px; color: #1a1a1a; }
    .sub-title { color: #F38218; font-size: 0.9rem; font-weight: 500; margin-bottom: 30px; }

    .form-group { margin-bottom: 20px; }
    label { display:block; font-size: 0.95rem; font-weight:700; margin-bottom:8px; color:#333; }

    input, select {
      width: 100%; padding: 15px;
      border: 1px solid #E0E0E0; border-radius: 10px;
      background-color: #FAFAFA; font-size: 1rem;
      box-sizing: border-box; transition: all 0.2s;
      font-family: inherit;
      max-width: 100%;
    }
    input:focus, select:focus { outline: none; border-color: #F38218; background-color: #fff; }

    /* iOS date input 폭 튐 방지(기본 글꼴/라인높이 안정화) */
    input[type="date"]{
      appearance: auto;
      -webkit-appearance: auto;
      line-height: 1.2;
    }

    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .btn-prev,
    .btn-next {
      border: none;
      padding: 15px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 800;
      font-size: 1rem;
      box-sizing: border-box;
    }

    .btn-prev {
      background-color: #F38218;
      color: white;
      flex: 1;
    }

    .btn-next {
      background-color: #F38218;
      color: white;
      flex: 2;
    }

    .btn-next:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    @media (max-width: 360px) {
      .btn-prev, .btn-next {
        padding: 14px;
        font-size: 0.95rem;
      }
    }

    /* ─────────────────────────────
       모바일/태블릿 반응형 + 안정화 패치
       ───────────────────────────── */
    @media (max-width: 768px) {
      html, body { width: 100%; max-width: 100%; overflow-x: hidden; }
      *, *::before, *::after { box-sizing: border-box; }
      img, video, svg, canvas { max-width: 100%; height: auto; }
      input, select, button { max-width: 100%; }

      .header-container { max-width: 420px; padding: 32px 16px 18px; }
      .bear-logo { width: 110px; margin-bottom: 16px; }
      .card { max-width: 420px; padding: 26px; }
    }

    @media (max-width: 480px) {
      .header-container { padding: 26px 14px 16px; }
      .bear-logo { width: 100px; }
      .progress-container { width: 86%; }

      .card { width: 92%; padding: 22px; margin-bottom: 28px; }
      h2 { font-size: 1.25rem; }
      .sub-title { margin-bottom: 22px; }

      input, select { padding: 14px; }
      .btn-group { gap: 8px; }
      .btn-prev, .btn-next { padding: 14px; font-size: 0.98rem; }
    }
  </style>
</head>

<body>
  <div class="header-container">
    <a href="/"><img src="{% static 'nav_img/logo.png' %}" alt="BEAR logo" class="bear-logo"></a>
    <div class="progress-container"><div class="progress-bar"></div></div>
  </div>

  <div class="card">
    <h2>Step 2/4. 기본 신체 정보</h2>
    <div class="sub-title">정확한 분석을 위해 정보를 입력해주세요</div>

    <form id="step2Form" method="post" action="{% url 'accounts_app:signup_step2' %}">
      {% csrf_token %}

      <div class="form-group">
        <label for="gender">성별</label>
        <select name="gender" id="gender" required>
          <option value="M" {% if gender == "M" %}selected{% endif %}>남성</option>
          <option value="F" {% if gender == "F" %}selected{% endif %}>여성</option>
        </select>
      </div>

      <div class="form-group">
        <label for="birth_dt">생년월일</label>
        <input type="date" name="birth_dt" id="birth_dt"
               value="{{ birth_dt_ui|default:'2000-01-01' }}" required>
      </div>

      <div class="form-group">
        <label for="height_cm">키 (cm)</label>
        <input type="number" name="height_cm" id="height_cm"
               value="{{ height_cm|default:'175.5' }}"
               step="0.1" min="50" max="300" required>
      </div>

      <div class="form-group">
        <label for="weight_kg">체중 (kg)</label>
        <input type="number" name="weight_kg" id="weight_kg"
               value="{{ weight_kg|default:'65.2' }}"
               step="0.1" min="10" max="500" required>
      </div>

      <div class="btn-group">
        <button type="button" class="btn-prev" id="prevBtn">이전</button>
        <button type="submit" class="btn-next" id="nextBtn" disabled>다음 단계</button>
      </div>
    </form>
  </div>

  <script>
    (function () {
      const form = document.getElementById("step2Form");
      if (!form) return;

      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      const gender = document.getElementById("gender");
      const birth = document.getElementById("birth_dt");
      const height = document.getElementById("height_cm");
      const weight = document.getElementById("weight_kg");

      function allValid() {
        const hasAll =
          (gender.value || "").trim() &&
          (birth.value || "").trim() &&
          (height.value || "").trim() &&
          (weight.value || "").trim();

        if (!hasAll) return false;

        return (
          gender.checkValidity() &&
          birth.checkValidity() &&
          height.checkValidity() &&
          weight.checkValidity()
        );
      }

      function updateNext() {
        nextBtn.disabled = !allValid();
      }

      prevBtn.addEventListener("click", () => history.back());

      ["input", "change", "keyup"].forEach((evt) => {
        gender.addEventListener(evt, updateNext);
        birth.addEventListener(evt, updateNext);
        height.addEventListener(evt, updateNext);
        weight.addEventListener(evt, updateNext);
      });

      form.addEventListener("submit", (e) => {
        updateNext();
        if (!allValid()) {
          e.preventDefault();
        }
      });

      updateNext();
    })();
  </script>
</body>
</html>