{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/timeline.css' %}">
{% endblock %}

{% block content %}

<!-- (1) 주간 누적 막대 그래프 -->
<section class="timeline-section">
  <div class="timeline-card">
    <div class="timeline-card-head">
      <h4 class="timeline-title">감정 변화 요약</h4>

      <div class="timeline-date-range">
        <!-- 나중에 date picker 붙일 자리 -->
        <span class="timeline-range-text">{{ week_start }} ~ {{ week_end }}</span>
      </div>
    </div>

    <div class="timeline-chart-wrap">
      <!-- 차트 반응형을 위해 canvas를 wrap으로 감싸는 게 안정적 -->
      <canvas id="weeklyEmotionChart"></canvas>
    </div>
  </div>
</section>

<!-- (2) ML 부정 감정 예측 결과 -->
<section class="timeline-section">
  <div class="timeline-card">
    <div class="timeline-card-head">
      <h4 class="timeline-title">부정 감정 예측</h4>
    </div>

    <div class="prediction-box">
      <p>
        예측 결과:
        <strong>{{ risk_label }}</strong>
        (score: {{ risk_score }})
      </p>
    </div>
  </div>
</section>

<!-- (3) LLM 멘트 -->
<section class="timeline-section">
  <div class="timeline-card">
    <div class="timeline-card-head">
      <h4 class="timeline-title">행동 추천</h4>
    </div>

    <div class="llm-box">
      <p>{{ llm_ment }}</p>
    </div>
  </div>
</section>

<!-- ✅ Chart data (view에서 chart_json으로 내려줌: json.dumps 결과) -->
<script id="weeklyEmotionData" type="application/json">
{{ chart_json|safe }}
</script>

<!-- 차트 JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/timeline.js' %}"></script>

{% endblock %}
