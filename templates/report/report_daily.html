{% extends "report/report_base.html" %}
{% load static %}

{% block details %}
<!-- ë‚ ì§œ ì„ íƒ -->
<div class="report-datepicker" id="date-picker-trigger">
  <span class="report-datepicker-icon">ğŸ“…</span>
  <span class="report-datepicker-text">{{ selected_date }}</span>
  <input type="text" id="date-picker" class="report-datepicker-input" placeholder="ë‚ ì§œ ì„ íƒ">
</div>

<script>
$(function () {
  const defaultDateStr = "{{ selected_date }}";

  $('#date-picker').datepicker({
    format: 'yyyy-mm-dd',
    language: 'ko',
    autoclose: true,
    endDate: new Date(),
    todayHighlight: false,
    orientation: 'bottom left'
  }).on('changeDate', function (e) {
    const selected = e.format('yyyy-mm-dd');

    // í™”ë©´ì— ë³´ì´ëŠ” ë‚ ì§œ ê°±ì‹ 
    $('.report-datepicker-text').text(selected);

    // ì‹¤ì œ í˜ì´ì§€ ì´ë™ (í•„ìš”í•œ ê²½ìš°)
    window.location.search = `?date=${selected}`;
    });

  // ë°” ì „ì²´ í´ë¦­ ì‹œ ë‹¬ë ¥ ì—´ê¸°
  $('#date-picker-trigger').on('click', function () {
      $('#date-picker').datepicker('show');
  });
});

</script>

{% if has_data %}
  <!-- =========================
       ì˜¤ëŠ˜ì˜ ìš”ì•½ ì¹´ë“œ
       ========================= -->
  <div class="summary-card">
    <div class="summary-title">
      <span>ì˜¤ëŠ˜ì˜ ìš”ì•½</span>
    </div>

    <div class="feedback-card">
      <img class="feedback-ico" src="{% static 'icons_img/bear_report.png' %}" alt="bear feedback">
      <div class="feedback-text">
        ì˜¤ëŠ˜ì€ ì¡°ê¸ˆ í˜ë“¤ì—ˆê² ì§€ë§Œ, ê¸ì •ì ì¸ ê¸°ìš´ì´ ë” ë§ì•˜ì–´. ë‹¨ë°±ì§ˆì´ í’ë¶€í•œ ì‹ì‚¬ë¡œ í˜ì„ ë³´ì¶©í•´ë³´ì!
        í–‡ì‚´ ê°€ë“í•œ ì €ë…ì´ ë„ˆë¥¼ ë”°ëœ»í•˜ê²Œ ê°ì‹¸ì¤¬ì„ ê±°ì•¼.
      </div>
    </div>
  </div>

  <!-- =========================
       ì˜ì–‘ì†Œ ì¹´ë“œ
       ========================= -->
  <div class="summary-card">
    <!-- ì œëª© + í† ê¸€ í•œ ì¤„ -->
    <div class="nutrition-header">
      <span class="nutrition-title">ì˜ì–‘ì†Œ</span>

      <div class="nut-sum-type-toggle">
        <button class="toggle-btn active" data-target="summary">ìš”ì•½</button>
        <span class="divider">|</span>
        <button class="toggle-btn" data-target="detail">ìì„¸íˆ</button>
      </div>
    </div>

    <div id="report-nut-data" data-nut-day='{{ nut_day|safe }}'></div>

    <!-- ìš”ì•½ ë‚´ìš© (ê¸°ë³¸ ë…¸ì¶œ) -->
    <div class="summary-content">

      <div class="nut-row" data-nutrient="kcal">
        <div class="nut-title">ì¹¼ë¡œë¦¬</div>
        <div class="nut-text"></div>
        <div class="nut-bar"><span></span></div>
      </div>

      <div class="nut-row" data-nutrient="carb">
        <div class="nut-title">íƒ„ìˆ˜í™”ë¬¼</div>
        <div class="nut-text"></div>
        <div class="nut-bar"><span></span></div>
      </div>

      <div class="nut-row" data-nutrient="protein">
        <div class="nut-title">ë‹¨ë°±ì§ˆ</div>
        <div class="nut-text"></div>
        <div class="nut-bar"><span></span></div>
      </div>

      <div class="nut-row" data-nutrient="fat">
        <div class="nut-title">ì§€ë°©</div>
        <div class="nut-text"></div>
        <div class="nut-bar"><span></span></div>
      </div>

    </div>

    <!-- ìì„¸íˆ ë‚´ìš© -->
    <div class="detail-content">

      <div class="detail-grid">
        <!-- LEFT COLUMN -->
        <div class="detail-left">

          <!-- ì‹ì‚¬ ì„ íƒ -->
          <div class="meal-toggle">
            <img src="/static/icons_img/morning.png"
                 class="meal-btn active"
                 data-meal="morning"
                 alt="ì•„ì¹¨">
            <img src="/static/icons_img/lunch.png"
                 class="meal-btn"
                 data-meal="lunch"
                 alt="ì ì‹¬">
            <img src="/static/icons_img/dinner.png"
                 class="meal-btn"
                 data-meal="dinner"
                 alt="ì €ë…">
          </div>

          <!-- ë©”ë‰´ëª… -->
          <div class="meal-menu">
            <div class="meal-menu-title">ë©”ë‰´</div>
            <div class="meal-menu-text"></div>
          </div>

        </div>

        <!-- RIGHT COLUMN -->
        <div class="detail-right">

          <!-- ë„ë„› ì°¨íŠ¸ -->
          <div class="meal-donut-wrap">
            <canvas id="macroDonutChart"></canvas>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- =========================
       ê¸°ë¶„ ì¹´ë“œ
       ========================= -->
  <div class="summary-card">
    <div class="summary-title">
      <span>ê¸°ë¶„</span>
    </div>

    <div class="detail-grid">
      <!-- LEFT COLUMN -->
      <div class="mood-left">
        <!-- ê¸°ë¶„ ìºë¦­í„° -->
        <div class="mood_img"></div>
        <!-- ì˜¤ëŠ˜ ê°ì • ë©˜íŠ¸ -->
        <div class="mood_text"></div>
      </div>

      <!-- RIGHT COLUMN -->
      <div class="mood-right" id="report-mood-data" data-mood-ratio='{{ mood_ratio|safe }}'>
        <!-- ë„ë„› ì°¨íŠ¸ -->
        <div class="mood-donut-wrap">
          <canvas id="moodDonutChart"></canvas>
        </div>
      </div>
    </div>
  </div>
{% else %}
  <!-- =========================
       ì˜¤ëŠ˜ì˜ ìš”ì•½ ì¹´ë“œ
       ========================= -->
  <div class="summary-card">
    <div class="summary-title">
      <span>ì˜¤ëŠ˜ì˜ ìš”ì•½</span>
    </div>

    <div class="feedback-card">
      <img class="feedback-ico" src="{% static 'icons_img/bear_report.png' %}" alt="bear feedback">
      <div class="feedback-text">
        ê¸°ë¡ì„ ë‚¨ê¸°ë©´ ì´ ë‚ ì˜ ë¦¬í¬íŠ¸ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”. <br>
        ê¸°ë¡ì„ í•˜ëŸ¬ ë– ë‚˜ ë³¼ê¹Œìš”? ğŸ˜‰
      </div>
    </div>
  </div>

  <!-- =========================
       ì˜ì–‘ì†Œ ì¹´ë“œ
       ========================= -->
  <div class="summary-card">
    <!-- ì œëª© + í† ê¸€ í•œ ì¤„ -->
    <div class="nutrition-header">
      <span class="nutrition-title">ì˜ì–‘ì†Œ</span>

      <div class="nut-sum-type-toggle">
        <button class="toggle-btn active" data-target="summary">ìš”ì•½</button>
        <span class="divider">|</span>
        <button class="toggle-btn" data-target="detail">ìì„¸íˆ</button>
      </div>
    </div>

    <!-- ìš”ì•½ ë‚´ìš© (ê¸°ë³¸ ë…¸ì¶œ) -->
    <div class="card-empty">
      <span>ì•„ì§ ì´ ë‚ ì˜ ê¸°ë¡ì„ ë‚¨ê¸°ì§€ ì•Šì•˜ì–´ìš”.</span>
    </div>
  </div>

  <!-- =========================
       ê¸°ë¶„ ì¹´ë“œ
       ========================= -->
  <div class="summary-card">
    <div class="summary-title">
      <span>ê¸°ë¶„</span>
    </div>

    <div class="card-empty">
      <span>ì•„ì§ ì´ ë‚ ì˜ ê¸°ë¡ì„ ë‚¨ê¸°ì§€ ì•Šì•˜ì–´ìš”.</span>
    </div>
  </div>
{% endif %}

{% endblock %}
