{% extends "report/report_base.html" %}
{% load static %}

{% block details %}
<!-- ë‚ ì§œ ì„ íƒ -->
<div class="report-datepicker" id="date-picker-trigger">
  <span class="report-datepicker-icon">ğŸ“…</span>
  <span class="report-datepicker-text">{{ selected_date }}</span>
  <input type="text" id="date-picker" class="report-datepicker-input" placeholder="ë‚ ì§œ ì„ íƒ">
</div>

<script>
$(function () {
  const defaultDateStr = "{{ selected_date }}";

  $('#date-picker').datepicker({
    format: 'yyyy-mm-dd',
    language: 'ko',
    autoclose: true,
    endDate: new Date(),
    todayHighlight: false,
    orientation: 'bottom left'
  }).on('changeDate', function (e) {
    const selected = e.format('yyyy-mm-dd');

    // í™”ë©´ì— ë³´ì´ëŠ” ë‚ ì§œ ê°±ì‹ 
    $('.report-datepicker-text').text(selected);

    // ì‹¤ì œ í˜ì´ì§€ ì´ë™ (í•„ìš”í•œ ê²½ìš°)
    window.location.search = `?date=${selected}`;
    });

  // ë°” ì „ì²´ í´ë¦­ ì‹œ ë‹¬ë ¥ ì—´ê¸°
  $('#date-picker-trigger').on('click', function () {
      $('#date-picker').datepicker('show');
  });
});

</script>

<!-- =========================
     ì˜¤ëŠ˜ì˜ ìš”ì•½ ì¹´ë“œ
     ========================= -->
<div class="summary-card" id="daily-feedback-card"
     data-has-data="{{ has_data }}">
  <div class="summary-title">
    <span>ì˜¤ëŠ˜ì˜ ìš”ì•½</span>
  </div>

  <div class="feedback-card">
    <img class="feedback-ico" src="{% static 'icons_img/bear_report.png' %}" alt="bear feedback">
    <div class="feedback-text">
      {% if can_report %}
        {{ feedback }}
      {% else %}
        ì €ë… ì‹ì‚¬ ê¸°ë¡ ë˜ëŠ” ì €ë… 8ì‹œ ì´í›„ì— í™•ì¸ ê°€ëŠ¥í•´ìš”!
      {% endif %}
    </div>
  </div>

  <div class="feedback-card card-empty" id="daily-feedback-empty">
    <img class="feedback-ico" src="{% static 'icons_img/bear_report.png' %}" alt="bear feedback">
    <div class="feedback-text">
      ì•„ì§ ì´ ë‚ ì˜ ê¸°ë¡ì„ ë‚¨ê¸°ì§€ ì•Šì•˜ì–´ìš”. <br>
      ë¦¬í¬íŠ¸ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ê¸°ë¡ì„ í•˜ëŸ¬ ë– ë‚˜ ë³¼ê¹Œìš”? ğŸ˜‰
    </div>
  </div>
</div>

<!-- =========================
     ì˜ì–‘ì†Œ ì¹´ë“œ
     ========================= -->
<div class="summary-card" id="daily-nutrition-card"
     data-has-data="{{ has_data }}">
  <!-- ì œëª© + í† ê¸€ í•œ ì¤„ -->
  <div class="nutrition-header">
    <span class="nutrition-title">ì˜ì–‘ì†Œ</span>

    <div class="nut-sum-type-toggle">
      <button class="toggle-btn active" data-target="summary">ìš”ì•½</button>
      <span class="divider">|</span>
      <button class="toggle-btn" data-target="detail">ìì„¸íˆ</button>
    </div>
  </div>

  <!-- ë¹ˆ ìƒíƒœ -->
  <div class="card-empty" id="daily-nutrition-empty">
    <span>ì•„ì§ ì´ ë‚ ì˜ ê¸°ë¡ì„ ë‚¨ê¸°ì§€ ì•Šì•˜ì–´ìš”.</span>
  </div>

  {% if can_report %}
  <!-- ìš”ì•½ ë‚´ìš© (ê¸°ë³¸ ë…¸ì¶œ) -->
  <div id="report-nut-data" data-nut-day='{{ nut_day|safe }}'></div>
  <div class="summary-content" id="daily-nutrition-chart-wrap">

    <div class="nut-row" data-nutrient="kcal">
      <div class="nut-title">ì¹¼ë¡œë¦¬</div>
      <div class="nut-text"></div>
      <div class="nut-bar"><span></span></div>
    </div>

    <div class="nut-row" data-nutrient="carb">
      <div class="nut-title">íƒ„ìˆ˜í™”ë¬¼</div>
      <div class="nut-text"></div>
      <div class="nut-bar"><span></span></div>
    </div>

    <div class="nut-row" data-nutrient="protein">
      <div class="nut-title">ë‹¨ë°±ì§ˆ</div>
      <div class="nut-text"></div>
      <div class="nut-bar"><span></span></div>
    </div>

    <div class="nut-row" data-nutrient="fat">
      <div class="nut-title">ì§€ë°©</div>
      <div class="nut-text"></div>
      <div class="nut-bar"><span></span></div>
    </div>

  </div>

  <!-- ìì„¸íˆ ë‚´ìš© -->
  <div class="detail-content">

    <div class="detail-grid">
      <!-- LEFT COLUMN -->
      <div class="detail-left">

        <!-- ì‹ì‚¬ ì„ íƒ -->
        <div class="meal-toggle">
          <img src="/static/icons_img/morning.png"
               class="meal-btn active"
               data-meal="morning"
               alt="ì•„ì¹¨">
          <img src="/static/icons_img/lunch.png"
               class="meal-btn"
               data-meal="lunch"
               alt="ì ì‹¬">
          <img src="/static/icons_img/dinner.png"
               class="meal-btn"
               data-meal="dinner"
               alt="ì €ë…">
        </div>

        <!-- ë©”ë‰´ëª… -->
        <div class="meal-menu">
          <div class="meal-menu-title">ë©”ë‰´</div>
          <div class="meal-menu-text"></div>
        </div>

        </div>

        <!-- RIGHT COLUMN -->
        <div class="detail-right">

          <!-- ë„ë„› ì°¨íŠ¸ -->
          <div class="meal-donut-wrap">
            <canvas id="macroDonutChart"></canvas>
          </div>

        </div>
      </div>
    </div>
  {% else %}
  <div class="card-empty">
    <span>ì €ë… ì‹ì‚¬ ê¸°ë¡ ë˜ëŠ” ì €ë… 8ì‹œ ì´í›„ì— í™•ì¸ ê°€ëŠ¥í•´ìš”!</span>
  </div>
  {% endif %}
  </div>

  <!-- =========================
       ê¸°ë¶„ ì¹´ë“œ
       ========================= -->
  <div class="summary-card" id="daily-mood-card"
       data-has-data="{{ has_data }}">
    <div class="summary-title">
      <span>ê¸°ë¶„</span>
    </div>

    {%if can_report %}
    <div class="detail-grid" id="daily-mood-chart-wrap">
      <!-- LEFT COLUMN -->
      <div class="mood-left">
        <!-- ê¸°ë¶„ ìºë¦­í„° -->
        <div class="mood_img"></div>
        <!-- ì˜¤ëŠ˜ ê°ì • ë©˜íŠ¸ -->
        <div class="mood_text"></div>
      </div>

      <!-- RIGHT COLUMN -->
      <div class="mood-right" id="report-mood-data" data-mood-ratio='{{ mood_day|safe }}'>
        <!-- ë„ë„› ì°¨íŠ¸ -->
        <div class="mood-donut-wrap">
          <canvas id="moodDonutChart"></canvas>
        </div>
      </div>
    </div>
    {% else %}
    <div class="card-empty">
      <span>ì €ë… ì‹ì‚¬ ê¸°ë¡ ë˜ëŠ” ì €ë… 8ì‹œ ì´í›„ì— í™•ì¸ ê°€ëŠ¥í•´ìš”!</span>
    </div>
    {% endif %}
    
    <div class="card-empty" id="weekly-mood-empty">
      <span>ì•„ì§ ì´ ë‚ ì˜ ê¸°ë¡ì„ ë‚¨ê¸°ì§€ ì•Šì•˜ì–´ìš”.</span>
    </div>
  </div>

{% endblock %}
