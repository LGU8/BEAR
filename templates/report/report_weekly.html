{% extends "report/report_base.html" %}
{% load static %}

{% block details %}
<!-- ë‚ ì§œ ì„ íƒ -->
<div class="report-datepicker" id="week-picker-trigger">
  <span class="report-datepicker-icon">ğŸ“…</span>
  <span class="report-datepicker-text">{{ week_start }} ~ {{ week_end }}</span>
  <input type="text" id="week-picker" class="report-datepicker-input" placeholder="ë‚ ì§œ ì„ íƒ">
</div>

<script>
$(function () {
  const weekStartStr = "{{ week_start }}";
  const weekEndStr   = "{{ week_end }}";

  // ì´ë²ˆì£¼ ë‚ ì§œ ì„ íƒ ë°©ì§€
  const today = new Date();
  const day = today.getDay(); // ì¼=0, ì›”=1, ..., í† =6
  const mondayThisWeek = new Date(today);
  const diffToMonday = (day === 0 ? -6 : 1 - day);
  mondayThisWeek.setDate(today.getDate() + diffToMonday);
  const lastSelectableDate = new Date(mondayThisWeek);
  lastSelectableDate.setDate(mondayThisWeek.getDate() - 1);

  // datepicker ì´ˆê¸°í™”
  $('#week-picker').datepicker({
    format: 'yyyy-mm-dd',       // ì„œë²„ì—ì„œ get_selected_dateê°€ ê¸°ëŒ€í•˜ëŠ” í˜•ì‹
    language: 'ko',
    autoclose: true,
    endDate: lastSelectableDate,        // ë¯¸ë˜ ì„ íƒ ë°©ì§€ (ì›í•˜ë©´ ì œê±°)
    todayHighlight: false,
    orientation: 'bottom left'
  });

  // ë‚ ì§œ ì„ íƒ ì‹œ â†’ ì„œë²„ë¡œ date í•˜ë‚˜ë§Œ ì „ë‹¬
  $('#week-picker').on('changeDate', function (e) {
    const selectedDate = e.format('yyyy-mm-dd');

    // ì„œë²„ê°€ week_start / week_end ê³„ì‚°
    window.location.search = `?date=${selectedDate}`;
  });

  // ë°” ì „ì²´ í´ë¦­ ì‹œ ë‹¬ë ¥ ì—´ê¸°
  $('#week-picker-trigger').on('click', function () {
    $('#week-picker').datepicker('show');
  });
});
</script>

<!-- =========================
     ì˜¤ëŠ˜ì˜ ìš”ì•½ ì¹´ë“œ
     ========================= -->
<div class="summary-card">
  <div class="summary-title">
    <span>ì˜¤ëŠ˜ì˜ ìš”ì•½</span>
  </div>

  <div class="feedback-card">
    <img class="feedback-ico" src="{% static 'icons_img/bear_report.png' %}" alt="bear feedback">
    <div class="feedback-text">
      ì˜¤ëŠ˜ì€ ì¡°ê¸ˆ í˜ë“¤ì—ˆê² ì§€ë§Œ, ê¸ì •ì ì¸ ê¸°ìš´ì´ ë” ë§ì•˜ì–´. ë‹¨ë°±ì§ˆì´ í’ë¶€í•œ ì‹ì‚¬ë¡œ í˜ì„ ë³´ì¶©í•´ë³´ì!
      í–‡ì‚´ ê°€ë“í•œ ì €ë…ì´ ë„ˆë¥¼ ë”°ëœ»í•˜ê²Œ ê°ì‹¸ì¤¬ì„ ê±°ì•¼.
    </div>
  </div>
</div>

<!-- =========================
     ì˜ì–‘ì†Œ ì¹´ë“œ
     ========================= -->
<div class="summary-card">
  <!-- ì œëª© + í† ê¸€ í•œ ì¤„ -->
  <div class="nutrition-header">
    <span class="nutrition-title">ì˜ì–‘ì†Œ</span>

    <div class="nut-type-toggle">
      <button class="toggle-btn active" data-target="kcal">ì¹¼ë¡œë¦¬</button>
      <span class="divider">|</span>
      <button class="toggle-btn" data-target="carb">íƒ„ìˆ˜í™”ë¬¼</button>
      <span class="divider">|</span>
      <button class="toggle-btn" data-target="protein">ë‹¨ë°±ì§ˆ</button>
      <span class="divider">|</span>
      <button class="toggle-btn" data-target="fat">ì§€ë°©</button>
    </div>
  </div>

  <!-- ìš”ì•½ ë‚´ìš© (ê¸°ë³¸ ë…¸ì¶œ) -->
  <div class="summary-content">

    <div class="nut-row" data-nutrient="calorie">
      <div class="nut-title">ì¹¼ë¡œë¦¬</div>
      <div class="nut-text"></div>
      <div class="nut-bar"><span></span></div>
    </div>

    <div class="nut-row" data-nutrient="carb">
      <div class="nut-title">íƒ„ìˆ˜í™”ë¬¼</div>
      <div class="nut-text"></div>
      <div class="nut-bar"><span></span></div>
    </div>

    <div class="nut-row" data-nutrient="protein">
      <div class="nut-title">ë‹¨ë°±ì§ˆ</div>
      <div class="nut-text"></div>
      <div class="nut-bar"><span></span></div>
    </div>

    <div class="nut-row" data-nutrient="fat">
      <div class="nut-title">ì§€ë°©</div>
      <div class="nut-text"></div>
      <div class="nut-bar"><span></span></div>
    </div>

  </div>

  <!-- ìì„¸íˆ ë‚´ìš© -->
  <div class="detail-content">

    <div class="detail-grid">
      <!-- LEFT COLUMN -->
      <div class="detail-left">

        <!-- ì‹ì‚¬ ì„ íƒ -->
        <div class="meal-toggle">
          <img src="/static/icons_img/morning.png"
               class="meal-btn active"
               data-meal="morning"
               alt="ì•„ì¹¨">
          <img src="/static/icons_img/lunch.png"
               class="meal-btn"
               data-meal="lunch"
               alt="ì ì‹¬">
          <img src="/static/icons_img/dinner.png"
               class="meal-btn"
               data-meal="dinner"
               alt="ì €ë…">
        </div>

        <!-- ë©”ë‰´ëª… -->
        <div class="meal-menu">
          <div class="meal-menu-title">ë©”ë‰´</div>
          <div class="meal-menu-text">ê³„ë€í›„ë¼ì´, í† ìŠ¤íŠ¸</div>
        </div>

      </div>

      <!-- RIGHT COLUMN -->
      <div class="detail-right">

        <!-- ë„ë„› ì°¨íŠ¸ -->
        <div class="meal-donut-wrap">
          <canvas id="macroDonutChart"></canvas>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- =========================
     ê¸°ë¶„ ì¹´ë“œ
     ========================= -->
<div class="summary-card">
  <div class="summary-title">
    <span>ê¸°ë¶„</span>
  </div>

  <div class="detail-grid">
    <!-- LEFT COLUMN -->
    <div class="mood-left">
      <!-- ê¸°ë¶„ ìºë¦­í„° -->
      <div class="mood_img"></div>
      <!-- ì˜¤ëŠ˜ ê°ì • ë©˜íŠ¸ -->
      <div class="mood_text"></div>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="mood-right">
      <!-- ë„ë„› ì°¨íŠ¸ -->
      <div class="mood-donut-wrap">
        <canvas id="moodDonutChart"></canvas>
      </div>
    </div>
  </div>
</div>

{% endblock %}
